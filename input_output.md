# 临时文件使用完必须及时删除

程序员经常会创建临时文件，如在/var/tmp。这样的目录可能会被定期清理。但未被清理前还是可访问的。每个程序都有责任确保删除已使用完毕的临时文件。

# 创建文件时必须显示指定合适的文件访问权限

多用户的文件系统是通过权限和许可模型来保护文件可访问的。多用户系统中的文件通常归属于某个特定的用户。攻击者可能通过其他用户攻击。因此创建文件时就为其指定访问权限，以防止未授权的文件访问。

最好指定0600，或者0644的权限

**反例**

```go
f ,err := os.Creat("/tmp/test.txt") // 不符合：没有显示指定文件权限
```

正例

```go
f ,err := os.OpenFile("/tmp/test.txt",os.O_CREATE|OS_WRONLY|OS_TRUNC,0600) 
```

# 确保检验文件路径前对其标准化

绝对路径名或者相对路径名中可能包含文件链接（软链接、硬链接、快捷方式、影子文件、别名等）。或者包含特殊字符（如.或..），者使得验证文件路径变得困难。如不检验，工具者可以通过路径，达到攻击的目的。

在文件操作之前，必须对文件路径进行验证，对文件路径标准化，会使得验证文件路径更简单安全。

**反例**

```go
func validate(path string) bool {
    pattern := "^/opt/pwm"  // 不符合：未把文件路径标准化，当path为 /opt/pwd/../../etc/passwd时,攻击者可以绕过验证。
    reg := regexp.MustComplie(pattern)
    return reg.MatchString(path)
}
```

**正例**

```go
func validate(path string) bool {
    realPath,err := filepath.Abs(path)
    if err != nil {
        return false
    }
    pattern := "^/opt/pwm"  
    reg := regexp.MustComplie(pattern)
    return reg.MatchString(realPSath)
}
```

# 确保安全地从压缩包提取文件

解压文件时有两个问题需要避免

- 提取文件的标准路径是否落在解压目录之外
- 提取的文件是否消耗过多的系统资源

需要增加文件数量、文件大小、路径标准化等检验操作

# 禁止直接使用外部数据构造格式化字符串

攻击者可以直接控制格式化字符串时，可导致信息泄漏、拒绝服务、系统功能异常等风险。

**反例**

```go
func checked(user string) {
    msg := fmt.Sprintf("%s ddd",user)
    fmt.Printf(msg)  // 不符合：msg存在为验证的外部数据，存在格式化漏洞，当指定外部格式为%p，%d会导致格式化出现非预期的结果
}
```

# 禁止在日志中保存敏感数据

在日中禁止输出口令、秘钥和其他保护信息。口令包括明文口令和密文口令，对于敏感信息采用以下方法：

- 不在日志中打印敏感信息
- 不将敏感信息输出到控制台和串口
- 如因特殊原因必须打印日志，使用固定长度的*代替敏感信息
- 序列化或者输出敏感信息应该先加密后，输出到外部设备或者文件中
- 禁止在错误或异常处理中泄漏敏感信息